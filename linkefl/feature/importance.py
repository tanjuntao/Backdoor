import numpy as np
import shap
from xgboost import XGBClassifier, XGBRegressor

from linkefl.common.const import Const


def cal_importance_ranking(
    dataset_name: str,
    feats: np.ndarray,
    labels: np.ndarray,
    measurement: str = "xgboost",
) -> np.ndarray:
    if dataset_name in (
        "cancer",
        "digits",
        "epsilon",
        "census",
        "credit",
        "default_credit",
        "diabetes",
        "mnist",
        "fashion_mnist",
    ):
        ranking = _cached_permutation(dataset_name, measurement)
        return ranking

    n_classes = len(np.unique(labels))
    if dataset_name in Const.DATA_TYPE_DICT[Const.REGRESSION]:
        dataset_type = Const.REGRESSION
    else:
        dataset_type = Const.CLASSIFICATION
    if dataset_type == Const.REGRESSION:  # regression dataset
        model = XGBRegressor()
        model.fit(feats, labels)
    else:  # classification dataset
        if n_classes == 2:
            # binary case: silent warnings of XGB Constructor
            model = XGBClassifier(use_label_encoder=False, eval_metric="logloss")
            model.fit(feats, labels)
        else:  # multiclass case
            model = XGBClassifier()
            model.fit(feats, labels)

    if measurement == "xgboost":
        # XGBClassifier uses gain to measure feature importance as default
        # already normalized
        importances = model.feature_importances_
        # descending order with resepect to feature index
        ranking = np.argsort(importances)[::-1]
    elif measurement == "shap":
        explainer = shap.Explainer(model)
        shap_values = explainer(feats)
        if n_classes == 2:
            # in binary case, shape of shap_values is (n_samples, n_features)
            importances = np.mean(
                np.abs(shap_values.values), axis=0
            )  # summation along the vertical axis
            ranking = np.argsort(importances)[::-1]
        else:
            # in multiclass case, shape of shap_values is
            # (n_samples, n_features, n_classes)

            # first compute mean along the n_classes axis, then compute mean
            # along the n_samples axis
            importances = np.mean(np.mean(np.abs(shap_values.values), axis=2), axis=0)
            ranking = np.argsort(importances)[::-1]
    else:
        raise ValueError(
            f"measurement can only take 'shap' or 'xgboost', got {measurement} instead."
        )

    return ranking


# fmt: off
def _cached_permutation(dataset_name, measurement='xgboost'):
    """Buffer pre-computed feature importance rankings directly in code."""
    if dataset_name == 'cancer':
        if measurement == 'xgboost':
            _permutation = np.array(
                [27, 7, 22, 0, 23, 3, 26, 10, 21, 8, 20, 1, 13, 4, 14, 24, 19, 6,
                 15, 18, 5, 11, 29, 25, 28, 17, 9, 12, 16, 2])
        else:
            _permutation = np.array(
                [27, 23, 7, 13, 21, 26, 22, 15, 1, 4, 28, 18, 24, 20, 6, 5, 19, 10,
                 17, 11, 14, 29, 25, 0, 8, 3, 9, 12, 16, 2])

    elif dataset_name == 'digits':
        if measurement == 'xgboost':
            _permutation = np.array(
                [42, 54, 53, 20, 6, 60, 43, 30, 51, 12, 27, 33, 46, 10, 22, 5, 4,
                 29, 28, 35, 62, 19, 50, 18, 59, 44, 63, 25, 2, 14, 17, 38, 3, 26,
                 13, 11, 37, 58, 36, 45, 61, 41, 52, 34, 21, 9, 49, 1, 8, 7, 31, 15,
                 16, 23, 24, 32, 39, 40, 47, 48, 55, 56, 57, 0])
        else:
            _permutation = np.array(
                [42, 43, 5, 28, 18, 50, 20, 27, 54, 60, 53, 12,
                6, 33, 58, 38, 19, 3, 21, 51, 35, 37, 41, 22, 44, 11, 52, 2, 26, 4,
                9, 34, 61, 59, 46, 29, 10, 30, 62, 13, 45, 63, 36, 14, 49, 25, 17, 8,
                 7, 1, 31, 15, 16, 23, 24, 32, 39, 40, 47, 48, 55, 56, 57, 0])

    elif dataset_name == 'epsilon':
        if measurement == 'xgboost':
            _permutation = np.array(
                [40, 35, 0, 13, 80, 91, 47, 90, 63, 25, 24, 1, 78, 99, 30, 82, 27,
                 53, 89, 22, 48, 36, 21, 9, 44, 2, 28, 59, 75, 67, 74, 70, 88, 68,
                 62, 96, 51, 81, 15, 57, 84, 73, 3, 34, 76, 95, 71, 72, 77, 97, 45,
                 20, 8, 94, 10, 6, 98, 43, 86, 58, 14, 5, 61, 64, 37, 92, 60, 7, 32,
                 23, 11, 38, 83, 56, 39, 33, 19, 87, 42, 31, 49, 29, 50, 17, 65, 18,
                 66, 54, 93, 46, 41, 16, 52, 79, 69, 55, 12, 26, 85, 4])
        else:
            _permutation = np.array(
                [40, 35, 47, 13, 0, 25, 1, 99, 91, 82, 90, 80, 93, 28, 53, 97, 59,
                 16, 7, 57, 45, 87, 21, 78, 17, 27, 92, 50, 95, 2, 79, 88, 81, 10,
                 70, 62, 76, 67, 15, 23, 83, 38, 20, 12, 86, 8, 4, 36, 43, 64, 44,
                 5, 75, 94, 6, 41, 42, 68, 51, 56, 72, 49, 34, 54, 22, 77, 3, 37, 11,
                 58, 84, 63, 29, 98, 33, 89, 31, 55, 85, 46, 60, 39, 14, 48, 65, 73,
                 18, 26, 74, 66, 24, 9, 19, 96, 69, 61, 32, 30, 52, 71])

    elif dataset_name == 'census':
        if measurement == 'xgboost':
            _permutation = np.array(
                [12, 13, 2, 32, 22, 14, 34, 1, 33, 40, 3, 19, 31, 35, 26, 25, 9,
                 27, 0, 16, 23, 4, 5, 41, 7, 6, 8, 38, 28, 15, 48, 21, 44, 36,
                 24, 51, 20, 43, 52, 39, 45, 42, 37, 58, 17, 53, 29, 18, 50, 49,
                 59,
                 64, 54, 72, 73, 55, 47, 65, 69, 75, 76, 56, 67, 63, 66, 46, 74,
                 57,
                 61, 78, 77, 30, 10, 11, 71, 70, 68, 60, 62, 79, 80])
        else:
            _permutation = np.array(
                [0, 12, 2, 1, 4, 40, 32, 13, 31, 3, 33, 34, 19, 22, 23, 26, 14,
                 18, 20, 5, 36, 25, 35, 24, 9, 27, 6, 21, 16, 8, 41, 28, 7, 38,
                 29, 15, 44, 39, 37, 59, 51, 58, 54, 50, 42, 53, 47, 45, 64, 49,
                 43, 72, 17, 65, 48, 73, 55, 46, 69, 66, 76, 56, 52, 63, 57, 67,
                 75, 74, 30, 11, 10, 79, 60, 61, 62, 68, 70, 71, 77, 78, 80])

    elif dataset_name == 'credit':
        if measurement == 'xgboost':
            _permutation = np.array(
                [1, 7, 5, 3, 2, 0, 6, 8, 9, 4])
        else:
            _permutation = np.array(
                [5, 7, 1, 6, 8, 0, 9, 3, 2, 4])

    elif dataset_name == 'default_credit':
        if measurement == 'xgboost':
            _permutation = np.array(
                [18, 19, 20, 21, 22, 0, 13, 9, 1, 14, 8, 10, 15, 2, 7, 6, 12, 3,
                 11, 5, 4, 17, 16])
        else:
            _permutation = np.array(
                [18, 13, 1, 7, 9, 8, 19, 2, 3, 10, 6, 5, 12, 16, 20, 4, 11, 0,
                 17, 21, 15, 22, 14])

    elif dataset_name == 'diabetes':
        if measurement == 'xgboost':
            _permutation = np.array(
                [8, 2, 3, 7, 9, 1, 6, 5, 4, 0])
        else:
            _permutation = np.array(
                [8, 2, 3, 0, 6, 9, 5, 1, 4, 7])

    elif dataset_name == 'mnist':
        if measurement == 'xgboost':
            _permutation = np.array(
                [67, 70, 101, 740, 220, 583, 743, 709, 358, 100, 96, 104, 720,
                 713, 717, 435, 405, 94, 211, 489, 155, 406, 277, 657, 407, 437,
                 346, 410, 103, 564, 230, 328, 93, 350, 528, 156, 542, 243, 706,
                 569, 235, 514, 290, 487, 124, 329, 745, 163, 710, 570, 567,
                 107,
                 563, 270, 707, 578, 98, 438, 656, 400, 344, 217, 540, 404, 715,
                 343, 473, 276, 556, 432, 597, 126, 190, 543, 512, 360, 294,
                 486,
                 370, 457, 262, 210, 581, 431, 245, 242, 442, 347, 462, 429,
                 178,
                 326, 522, 213, 653, 205, 296, 300, 470, 153, 550, 598, 490,
                 267,
                 596, 453, 511, 517, 327, 544, 353, 164, 315, 318, 428, 177,
                 527,
                 345, 106, 516, 273, 289, 376, 374, 667, 231, 479, 539, 319,
                 379,
                 466, 148, 485, 401, 377, 582, 247, 158, 105, 209, 378, 499,
                 659,
                 151, 179, 367, 600, 95, 426, 638, 317, 455, 624, 464, 389, 269,
                 655, 507, 284, 128, 622, 330, 402, 295, 484, 568, 354, 271,
                 215,
                 298, 409, 375, 342, 538, 551, 708, 302, 381, 268, 458, 515,
                 719,
                 714, 127, 349, 434, 510, 321, 351, 316, 430, 610, 129, 427,
                 320,
                 246, 356, 373, 694, 535, 371, 626, 688, 185, 304, 212, 369,
                 439,
                 403, 408, 433, 606, 660, 712, 322, 333, 536, 460, 383, 203,
                 332,
                 69, 219, 206, 521, 372, 652, 348, 208, 380, 297, 359, 157, 498,
                 463, 154, 65, 654, 323, 690, 523, 132, 266, 546, 123, 658, 705,
                 444, 445, 478, 244, 173, 595, 324, 571, 149, 518, 176, 352,
                 557,
                 165, 579, 482, 620, 681, 399, 218, 683, 650, 133, 311, 272,
                 480,
                 648, 663, 275, 260, 387, 71, 711, 623, 239, 339, 634, 500, 628,
                 134, 331, 651, 301, 108, 150, 186, 293, 591, 425, 605, 488,
                 355,
                 555, 572, 472, 160, 668, 299, 636, 413, 519, 607, 541, 207,
                 357,
                 685, 627, 265, 441, 188, 580, 454, 214, 325, 182, 233, 635,
                 676,
                 398, 291, 382, 684, 661, 386, 664, 468, 633, 680, 414, 524,
                 526,
                 384, 662, 552, 744, 125, 191, 471, 92, 187, 292, 461, 146, 175,
                 147, 411, 174, 388, 456, 573, 689, 741, 746, 508, 119, 491,
                 682,
                 416, 686, 594, 232, 459, 467, 574, 695, 287, 256, 678, 303,
                 513,
                 201, 440, 274, 469, 601, 312, 249, 264, 554, 575, 368, 483,
                 237,
                 238, 474, 415, 181, 183, 603, 314, 263, 200, 637, 240, 687,
                 492,
                 509, 625, 436, 340, 493, 549, 497, 718, 722, 665, 131, 305,
                 553,
                 159, 102, 721, 91, 68, 90, 390, 228, 520, 496, 180, 692, 547,
                 66, 152, 566, 630, 604, 629, 192, 693, 236, 609, 649, 545, 747,
                 288, 677, 189, 608, 202, 184, 742, 122, 341, 417, 481, 222,
                 424,
                 599, 738, 248, 97, 121, 204, 286, 162, 530, 412, 261, 285, 130,
                 494, 166, 385, 443, 135, 592, 216, 397, 666, 576, 74, 548, 632,
                 138, 577, 716, 602, 537, 749, 679, 241, 257, 739, 639, 621,
                 525,
                 465, 691, 495, 234, 613, 136, 396, 258, 501, 99, 145, 221, 640,
                 120, 584, 631, 229, 193, 161, 529, 313, 593, 565, 361, 452,
                 733,
                 612, 611, 171, 44, 737, 283, 137, 619, 117, 259, 734, 73, 250,
                 76, 395, 172, 29, 31, 16, 18, 14, 30, 1, 32, 15, 17,
                 27, 19, 28, 24, 2, 26, 9, 8, 7, 21, 20, 144, 5,
                 143, 10, 11, 12, 13, 4, 23, 22, 25, 3, 6, 55, 33,
                 80, 63, 64, 118, 72, 75, 77, 116, 115, 114, 113, 78, 79,
                 81, 61, 82, 83, 84, 112, 111, 110, 109, 85, 86, 87, 88,
                 89, 62, 60, 142, 43, 141, 140, 139, 34, 35, 36, 37, 38,
                 39, 40, 41, 42, 45, 59, 46, 47, 48, 49, 50, 51, 52,
                 53, 54, 56, 57, 58, 783, 391, 167, 703, 696, 697, 698, 699,
                 700, 701, 702, 704, 589, 723, 724, 725, 726, 727, 728, 729,
                 675,
                 674, 673, 672, 614, 615, 616, 617, 618, 641, 642, 643, 644,
                 645,
                 646, 647, 669, 670, 671, 730, 731, 732, 765, 767, 768, 769,
                 770,
                 771, 772, 773, 774, 775, 776, 777, 778, 779, 780, 781, 766,
                 764,
                 735, 763, 736, 748, 750, 751, 752, 753, 754, 755, 756, 757,
                 758,
                 759, 760, 761, 762, 590, 588, 168, 309, 279, 280, 281, 282,
                 306,
                 307, 308, 310, 587, 334, 335, 336, 337, 338, 362, 363, 278,
                 255,
                 254, 253, 169, 170, 194, 195, 196, 197, 198, 199, 223, 224,
                 225,
                 226, 227, 251, 252, 364, 365, 366, 477, 503, 504, 505, 506,
                 531,
                 532, 533, 534, 558, 559, 560, 561, 562, 585, 586, 502, 476,
                 782,
                 475, 392, 393, 394, 418, 419, 420, 421, 422, 423, 446, 447,
                 448,
                 449, 450, 451, 0])
        else:
            _permutation = np.array([434, 350, 542, 569, 514, 405, 407, 406, 346, 489, 211, 490, 408, 543, 487, 269, 486, 348, 128, 462, 379, 438, 155, 374, 517,
                    402, 488, 297, 429, 516, 351, 378, 239, 318, 377, 322, 375, 404, 270, 290, 410, 572, 409, 349, 293, 401, 267, 158, 459, 491, 435,
                    156, 380, 214, 485, 515, 455, 321, 403, 317, 324, 570, 323, 347, 268, 183, 411, 354, 184, 430, 212, 544, 433, 466, 439, 400, 571,
                    376, 326, 296, 292, 373, 209, 242, 465, 182, 457, 656, 319, 518, 272, 294, 460, 458, 464, 325, 432, 344, 240, 345, 427, 352, 437,
                    271, 320, 235, 436, 210, 512, 327, 599, 241, 300, 295, 298, 238, 266, 428, 461, 628, 541, 431, 597, 381, 630, 657, 213, 595, 627,
                    382, 601, 181, 456, 372, 353, 316, 179, 596, 522, 513, 178, 153, 263, 493, 265, 684, 289, 243, 467, 568, 355, 328, 185, 356, 492,
                    299, 682, 180, 358, 659, 521, 600, 511, 371, 547, 399, 574, 483, 631, 545, 629, 463, 264, 236, 262, 206, 626, 685, 540, 575, 440,
                    548, 606, 607, 383, 578, 546, 343, 291, 686, 125, 683, 598, 519, 208, 573, 177, 624, 357, 567, 157, 654, 602, 484, 273, 661, 577,
                    414, 655, 244, 237, 539, 468, 188, 603, 159, 510, 154, 632, 520, 205, 523, 129, 186, 658, 625, 635, 549, 605, 495, 215, 207, 653,
                    216, 234, 301, 580, 217, 151, 126, 260, 329, 604, 494, 608, 384, 274, 131, 204, 315, 233, 152, 713, 576, 412, 149, 245, 387, 398,
                    553, 160, 330, 127, 261, 497, 710, 150, 551, 426, 712, 203, 124, 302, 342, 623, 566, 189, 232, 130, 550, 397, 190, 524, 688, 622,
                    441, 386, 101, 634, 538, 286, 187, 687, 370, 122, 633, 660, 554, 288, 469, 681, 581, 415, 454, 717, 231, 552, 385, 287, 220, 413,
                    525, 651, 161, 123, 662, 218, 496, 246, 594, 583, 740, 314, 219, 98, 711, 132, 276, 680, 689, 709, 303, 716, 176, 609, 652, 679,
                    663, 247, 743, 191, 579, 442, 482, 691, 175, 304, 444, 471, 100, 331, 470, 275, 715, 537, 359, 526, 163, 498, 509, 714, 259, 104,
                    664, 582, 528, 690, 103, 527, 416, 425, 742, 248, 637, 636, 97, 258, 102, 162, 99, 148, 201, 257, 610, 564, 313, 745, 70, 708, 638,
                    121, 369, 96, 341, 230, 481, 678, 368, 443, 453, 133, 650, 332, 499, 677, 147, 611, 719, 720, 228, 707, 202, 473, 229, 556, 285,
                    555, 94, 174, 360, 472, 277, 741, 340, 621, 93, 536, 388, 565, 480, 173, 739, 706, 737, 692, 67, 738, 134, 665, 507, 452, 105, 649
                    , 95, 120, 192, 500, 593, 718, 592, 584, 164, 666, 639, 146, 107, 563, 417, 693, 620, 69, 746, 396, 312, 92, 612, 501, 135, 747,
                    106, 256, 136, 284, 648, 667, 221, 339, 744, 119, 424, 508, 73, 145, 249, 165, 591, 389, 535, 283, 305, 66, 705, 193, 479, 734, 640
                    , 676, 445, 91, 694, 311, 529, 474, 166, 200, 721, 117, 619, 65, 557, 76, 733, 749, 367, 695, 68, 722, 138, 74, 222, 613, 390, 71,
                    108, 530, 172, 395, 668, 361, 333, 137, 478, 250, 90, 171, 44, 16, 80, 75, 18, 3, 1, 2, 17, 4, 5, 13, 83, 143, 87, 85, 86, 12, 11
                    , 10, 9, 20, 15, 8, 88, 144, 7, 6, 78, 79, 84, 14, 77, 82, 81, 19, 52, 21, 111, 42, 43, 61, 60, 45, 59, 58, 57, 56, 55, 109, 110,
                    112, 22, 113, 114, 115, 116, 118, 54, 53, 46, 47, 48, 49, 50, 41, 40, 39, 38, 23, 89, 142, 141, 140, 139, 72, 24, 25, 26, 27, 28,
                    29, 30, 31, 32, 51, 33, 64, 63, 62, 34, 35, 36, 37, 783, 391, 167, 703, 696, 697, 698, 699, 700, 701, 702, 704, 589, 723, 724, 725
                    , 726, 727, 728, 729, 675, 674, 673, 672, 614, 615, 616, 617, 618, 641, 642, 643, 644, 645, 646, 647, 669, 670, 671, 730, 731, 732
                    , 765, 767, 768, 769, 770, 771, 772, 773, 774, 775, 776, 777, 778, 779, 780, 781, 766, 764, 735, 763, 736, 748, 750, 751, 752, 753
                    , 754, 755, 756, 757, 758, 759, 760, 761, 762, 590, 588, 168, 309, 279, 280, 281, 282, 306, 307, 308, 310, 587, 334, 335, 336, 337
                    , 338, 362, 363, 278, 255, 254, 253, 169, 170, 194, 195, 196, 197, 198, 199, 223, 224, 225, 226, 227, 251, 252, 364, 365, 366, 477
                    , 503, 504, 505, 506, 531, 532, 533, 534, 558, 559, 560, 561, 562, 585, 586, 502, 476, 782, 475, 392, 393, 394, 418, 419, 420, 421
                    , 422, 423, 446, 447, 448, 449, 450, 451, 0])

    elif dataset_name == 'fashion_mnist':
        if measurement == 'xgboost':
            _permutation = np.array(
                [346, 337, 490, 655, 471, 408, 627, 339, 247, 779, 89, 481, 91,
                 733, 117, 39, 178, 518, 367, 390, 37, 343, 633, 718, 327, 77,
                 206, 499, 742, 549, 145, 592, 281, 315, 352, 267, 207, 403,
                 314,
                 423, 345, 38, 775, 13, 208, 738, 64, 191, 691, 62, 405, 417,
                 173, 92, 175, 119, 595, 745, 425, 232, 389, 406, 495, 219, 205,
                 443, 152, 200, 109, 593, 770, 249, 532, 17, 150, 489, 432, 600,
                 689, 748, 583, 555, 176, 572, 736, 387, 295, 630, 137, 526,
                 695,
                 322, 639, 14, 366, 546, 269, 302, 445, 469, 750, 36, 764, 739,
                 48, 744, 344, 236, 67, 221, 662, 594, 289, 380, 351, 681, 135,
                 714, 331, 41, 270, 317, 580, 557, 115, 434, 210, 301, 204, 283,
                 523, 353, 661, 385, 252, 40, 46, 192, 623, 675, 442, 608, 435,
                 560, 193, 477, 482, 446, 256, 527, 341, 713, 413, 356, 668,
                 160,
                 35, 358, 241, 512, 222, 357, 673, 776, 468, 422, 386, 106, 704,
                 554, 778, 676, 487, 98, 154, 235, 508, 414, 363, 76, 584, 665,
                 622, 185, 679, 227, 153, 162, 165, 182, 347, 667, 87, 613, 752,
                 611, 690, 95, 754, 285, 43, 377, 233, 612, 288, 214, 772, 378,
                 118, 316, 142, 725, 636, 80, 144, 710, 21, 226, 300, 132, 104,
                 723, 573, 190, 120, 298, 228, 407, 303, 194, 418, 134, 253,
                 257,
                 371, 379, 624, 147, 201, 521, 703, 282, 78, 429, 275, 453, 427,
                 767, 123, 362, 727, 126, 309, 651, 777, 696, 70, 381, 308, 460,
                 47, 642, 28, 133, 682, 620, 11, 412, 726, 155, 199, 702, 148,
                 234, 163, 340, 63, 42, 400, 1, 677, 506, 741, 444, 678, 658,
                 720, 707, 409, 181, 276, 517, 774, 640, 372, 342, 10, 540, 348,
                 649, 606, 286, 498, 220, 602, 273, 149, 577, 743, 416, 278,
                 313,
                 421, 44, 246, 335, 124, 231, 626, 596, 274, 384, 65, 599, 359,
                 637, 556, 688, 647, 161, 230, 451, 248, 237, 97, 781, 708, 539,
                 605, 280, 271, 638, 578, 287, 16, 449, 121, 93, 607, 69, 116,
                 45, 537, 609, 188, 529, 245, 20, 272, 719, 125, 565, 765, 7,
                 108, 610, 574, 769, 773, 551, 402, 664, 650, 189, 326, 238,
                 582,
                 552, 648, 462, 369, 321, 399, 255, 652, 15, 330, 260, 766, 217,
                 590, 699, 146, 737, 114, 395, 333, 94, 307, 547, 51, 615, 304,
                 751, 410, 433, 782, 311, 196, 324, 211, 242, 464, 711, 634,
                 753,
                 415, 261, 746, 575, 18, 483, 706, 243, 90, 122, 501, 397, 542,
                 203, 127, 538, 294, 625, 128, 105, 747, 5, 279, 666, 266, 568,
                 455, 334, 732, 504, 50, 657, 216, 567, 763, 541, 143, 509, 440,
                 500, 319, 450, 290, 428, 6, 680, 461, 697, 598, 497, 553, 49,
                 628, 107, 459, 209, 735, 33, 734, 312, 151, 566, 687, 99, 660,
                 174, 663, 621, 262, 244, 653, 717, 9, 79, 72, 374, 515, 284,
                 19, 398, 172, 277, 365, 325, 586, 32, 394, 171, 164, 355, 338,
                 659, 559, 170, 258, 360, 467, 493, 159, 24, 156, 364, 396, 669,
                 12, 519, 229, 438, 463, 441, 757, 494, 259, 759, 693, 780, 264,
                 224, 514, 486, 34, 131, 350, 183, 581, 740, 4, 368, 579, 71,
                 470, 721, 299, 654, 731, 66, 215, 254, 694, 130, 296, 375, 510,
                 591, 218, 31, 762, 56, 430, 530, 585, 528, 564, 177, 291, 113,
                 603, 8, 383, 329, 768, 68, 686, 771, 240, 488, 293, 683, 692,
                 749, 456, 310, 110, 74, 136, 75, 59, 100, 157, 391, 492, 478,
                 268, 525, 543, 102, 709, 496, 715, 635, 263, 52, 761, 411, 96,
                 716, 388, 426, 485, 656, 480, 701, 705, 576, 382, 180, 570,
                 472,
                 601, 373, 239, 328, 724, 439, 454, 618, 479, 722, 401, 265,
                 536,
                 424, 452, 187, 712, 631, 297, 535, 184, 88, 511, 520, 548, 202,
                 61, 318, 129, 465, 491, 755, 571, 457, 507, 54, 3, 619, 370,
                 569, 475, 419, 81, 73, 212, 629, 760, 597, 685, 641, 101, 179,
                 103, 672, 644, 729, 158, 561, 112, 516, 82, 550, 306, 349, 354,
                 544, 522, 447, 484, 404, 305, 524, 292, 545, 531, 466, 84, 186,
                 632, 614, 198, 197, 213, 643, 684, 250, 502, 588, 476, 448, 22,
                 323, 604, 730, 503, 431, 458, 60, 646, 589, 320, 169, 473, 332,
                 513, 392, 23, 437, 436, 167, 376, 558, 166, 563, 223, 698, 83,
                 111, 534, 474, 361, 562, 336, 30, 616, 53, 758, 505, 420, 139,
                 26, 533, 29, 670, 58, 393, 700, 728, 251, 138, 587, 645, 141,
                 617, 674, 195, 140, 85, 671, 86, 225, 55, 57, 2, 783, 25,
                 27, 168, 756, 0])
        else:
            _permutation = np.array([178, 205, 176, 770, 14, 232, 742, 345, 739, 260, 546, 315, 207, 10, 91, 206, 289, 175, 314, 231, 44, 43, 346, 150, 13, 70, 343
                    , 39, 446, 210, 123, 15, 92, 518, 69, 743, 769, 630, 204, 317, 389, 148, 17, 154, 442, 126, 302, 339, 41, 217, 772, 633, 471, 398,
                    303, 445, 247, 235, 300, 182, 342, 362, 42, 744, 655, 230, 46, 400, 357, 330, 417, 301, 149, 262, 661, 233, 121, 98, 764, 490,
                    414, 237, 733, 427, 316, 37, 241, 45, 778, 369, 390, 579, 416, 344, 48, 472, 11, 771, 18, 774, 269, 371, 736, 606, 177, 287, 498, 238,
                    634, 38, 124, 773, 40, 453, 64, 602, 765, 267, 574, 275, 203, 766, 242, 244, 469, 714, 119, 399, 370, 208, 337, 413, 265, 500,
                    767, 16, 214, 428, 299, 333, 385, 499, 245, 277, 319, 775, 689, 236, 215, 202, 384, 609, 718, 681, 627, 351, 379, 748, 528, 122, 288,
                    130, 331, 94, 468, 361, 272, 71, 372, 451, 434, 128, 750, 356, 608, 479, 65, 552, 506, 305, 425, 186, 386, 595, 779, 324, 649,
                    397, 19, 248, 481, 358, 513, 457, 443, 677, 378, 593, 610, 388, 191, 249, 713, 406, 456, 134, 47, 665, 327, 63, 135, 290, 234, 559,
                    639, 651, 723, 36, 537, 377, 585, 74, 482, 450, 100, 686, 430, 526, 295, 21, 347, 636, 270, 192, 93, 151, 664, 462, 125, 194, 320,
                    580, 294, 259, 489, 349, 467, 156, 529, 20, 441, 222, 273, 261, 637, 181, 433, 745, 401, 411, 67, 658, 373, 509, 95, 304, 72,
                    387, 551, 408, 268, 298, 318, 76, 667, 355, 605, 220, 720, 717, 297, 120, 350, 555, 527, 597, 219, 104, 484, 412, 523, 741, 444, 271,
                    77, 746, 229, 322, 161, 293, 497, 738, 776, 97, 407, 680, 487, 274, 107, 405, 429, 89, 68, 478, 380, 623, 676, 716, 777, 96, 565,
                    266, 632, 662, 239, 592, 106, 735, 576, 647, 550, 455, 512, 285, 715, 583, 652, 492, 747, 190, 558, 9, 101, 517, 612, 243, 547
                    , 496, 607, 193, 768, 470, 695, 611, 415, 740, 209, 577, 153, 184, 584, 183, 688, 594, 258, 75, 525, 542, 221, 706, 159, 440, 707,
                    511, 638, 578, 461, 640, 719, 173, 62, 264, 127, 328, 762, 567, 189, 439, 549, 596, 582, 666, 117, 501, 734, 296, 158, 402, 152,
                    240, 352, 211, 187, 263, 102, 539, 329, 391, 216, 626, 554, 323, 360, 600, 367, 118, 514, 341, 132, 692, 313, 507, 66, 631, 545,
                    460, 212, 354, 432, 50, 160, 483, 710, 668, 463, 663, 35, 78, 332, 325, 374, 540, 157, 348, 660, 495, 213, 560, 572, 418, 326, 375,
                    737, 381, 131, 763, 180, 601, 464, 286, 524, 163, 12, 678, 628, 564, 146, 185, 621, 145, 476, 573, 133, 454, 581, 410, 520, 571,
                    162, 624, 656, 682, 105, 477, 604, 165, 691, 599, 364, 570, 553, 403, 422, 426, 291, 708, 90, 246, 534, 155, 423, 657, 566, 732,
                    541, 353, 705, 711, 625, 709, 447, 436, 749, 548, 218, 278, 679, 99, 179, 510, 256, 7, 693, 284, 228, 684, 690, 486, 696, 515, 603,
                    465, 614, 103, 557, 73, 312, 521, 452, 598, 543, 307, 562, 653, 306, 359, 382, 712, 556, 503, 404, 494, 751, 409, 174, 530, 544,
                    466, 22, 532, 622, 575, 685, 493, 334, 79, 569, 721, 535, 147, 485, 635, 568, 227, 752, 488, 591, 538, 188, 276, 761, 449, 383,
                    659, 650, 654, 363, 419, 435, 629, 615, 321, 474, 438, 504, 292, 459, 613, 368, 437, 424, 458, 80, 502, 431, 516, 722, 129, 51, 536,
                    335, 648, 641, 694, 144, 508, 473, 683, 310, 392, 164, 200, 491, 8, 201, 279, 704, 34, 618, 522, 687, 376, 563, 257, 49, 480, 250
                    , 519, 366, 396, 586, 393, 669, 759, 505, 620, 588, 731, 166, 561, 223, 255, 280, 675, 108, 448, 137, 136, 475, 365, 6, 394, 703,
                    760, 87, 642, 340, 619, 199, 283, 617, 60, 421, 646, 780, 643, 116, 171, 587, 309, 281, 590, 531, 645, 81, 338, 33, 724, 143, 252,
                    198, 395, 172, 226, 674, 109, 114, 670, 4, 251, 701, 254, 533, 282, 308, 88, 336, 698, 32, 589, 311, 420, 115, 725, 52, 753, 61,
                    59, 616, 24, 5, 702, 142, 253, 23, 84, 697, 110, 31, 3, 169, 167, 699, 53, 671, 726, 673, 138, 224, 644, 672, 730, 781, 85, 758,
                    113, 195, 170, 754, 197, 700, 140, 757, 196, 139, 755, 782, 111, 729, 58, 727, 141, 82, 57, 225, 30, 112, 86, 54, 728, 1, 56, 28,
                    29, 55, 26, 83, 2, 783, 25, 27, 168, 756, 0])

    else:
        raise ValueError(f"np_dataset '{dataset_name}'' not supported.")

    return _permutation
# fmt: on
